<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Video</title>
  <meta name="description"              content="Video">
  <meta name="author"                             content="Chiara Crivelli">
  <meta name="viewport"                 content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable"         content="yes">
  <meta name="apple-mobile-web-app-capable"       content="yes">
  <meta name="theme-color"              content="black">
  <meta name="msapplication-navbutton-color"      content="black">
  <meta name="apple-mobile-web-app-status-bar-style"  content="black">
  <link rel="stylesheet" href="assets/css/style1.css">

</head>
  <main class="buttonVariable">  
  <div id="myDIV">
    <button class="btn btnVoice" id="btnVoice">Voice</button>
    <button class="btn btnMouse" id="btnMouse">Mouse</button>
    <button class="btn active" id="btnSlider">Slider</button>
  </div>
</main>

  <div class="topnav">
    <a href="index_Video.html" class="active">[E·motion]</a>
    <a href="index_About_ITA.html">About</a>
    <div class="topnav-right">
      <a href="index_Specimen.html">Specimen</a>
      <a href="index_Trial.html">Trial</a>
    </div>
  </div>

<main class="container">
  
  <div>
    <video width="800" controls>
      <source src="Khan.mp4" type="video/mp4">
      <source src="Khan.ogg" type="video/ogg">
      <script type="text/vtt" id="subtitle" data-label="English" data-lang="en">

      WEBVTT

      1
      00:00:00.200 --> 00:00:02.280
      Kahn? 

      2
      00:00:06.100 --> 00:00:08.100
      Khan, you've got Genesis,

      3
      00:00:08.200 --> 00:00:09.190
      but you don't
      have me.

      4
      00:00:09.200 --> 00:00:10.200
      If you're going
      to kill me, Khan,

      5
      00:00:10.210 --> 00:00:15.070
      you're going to have to
      come down here!

      6
      00:00:15.240 --> 00:00:18.290
      I've done far worse
      than kill you.

      7
      00:00:21.130 --> 00:00:23.220
      I've hurt you.

      8
      00:00:24.080 --> 00:00:28.060
      and I wish to go on
      hurting you.

      9
      00:00:31.020 --> 00:00:33.240
      I'shall leave you
      as you left me–

      10
      00:00:33.250 --> 00:00:35.290
      as you left her–

      11
      00:00:35.300 --> 00:00:38.090
      marroned for all
      eternity

      12
      00:00:38.100 --> 00:00:42.000
      in the center 
      of a dead planet

      13
      00:00:42.100 --> 00:00:46.030
      Buried alive eternity

      14
      00:00:47.100 --> 00:00:49.000
      KHAAAAAAAAAN!

      </script>
  </div>
  

    <div class="slidercontainer">
      <input type="range" min="-100" max="100" value="0" class="slider" id="SAJO" name="SAJO" data-index="0">

      <input type="range" min="-100" max="100" value="0" class="slider" id="DITR" name="DITR" data-index="1">

      <input type="range" min="-100" max="100" value="0" class="slider" id="ANFE" name="ANFE" data-index="2">

      <input type="range" min="-100" max="100" value="0" class="slider" id="ANSU" name="ANSU" data-index="3">


      <div class="slider-controls">
        <label for="text-SAJO" class="slider-label-left">Sadness/ Joy</label>
        <label for="text-SAJO" class="slider-label-right">
         [<span class="outputSAJO" id="demoSAJO">0</span>]   
        </label>
      </div>

      <div class="slider-controls">
        <label for="text-DITR" class="slider-label-left">Disgust/ Trust</label>
        <label for="text-DITR" class="slider-label-right">
          [<span class="outputDITR" id="demoDITR">0</span>] 
        </label>
      </div>

      <div class="slider-controls">
        <label for="text-ANFE" class="slider-label-left">Anger/ Fear</label>
        <label for="text-ANFE" class="slider-label-right">
          [<span class="outputANFE" id="demoANFE">0</span>] 
        </label>
      </div>

      <div class="slider-controls">
        <label for="text-ANSU" class="slider-label-left">Anticipation/ Surprise</label>
        <label for="text-ANSU" class="slider-label-right">
          [<span class="outputANSU" id="demoANSU">0</span>] 
        </label>
      </div>
    </div>
  </main>

<script>
  // Add active class to the current button (highlight it)
  var header = document.getElementById("myDIV");
  var btns = header.getElementsByClassName("btn");
  for (var i = 0; i < btns.length; i++) {
    btns[i].addEventListener("click", function() {
    var current = document.getElementsByClassName("active");
    if (current.length > 0) { 
      current[0].className = current[0].className.replace(" active", "");
    }
    this.className += " active";
    });
  }
</script>

<script type="text/javascript">
  document.ontouchmove = function(e){
    e.preventDefault();
  }
  document.ontouchmove = function(e){
    e.preventDefault();
  }
</script>

<script>
function parse_timestamp(s) {
  //var match = s.match(/^(?:([0-9]{2,}):)?([0-5][0-9]):([0-5][0-9][.,][0-9]{0,3})/);
  // Relaxing the timestamp format:
  var match = s.match(/^(?:([0-9]+):)?([0-5][0-9]):([0-5][0-9](?:[.,][0-9]{0,3})?)/);
  if (match == null) {
    throw 'Invalid timestamp format: ' + s;
  }
  var hours = parseInt(match[1] || "0", 10);
  var minutes = parseInt(match[2], 10);
  var seconds = parseFloat(match[3].replace(',', '.'));
  return seconds + 60 * minutes + 60 * 60 * hours;
}

// https://w3c.github.io/webvtt/
// https://developer.mozilla.org/en/docs/Web/API/Web_Video_Text_Tracks_Format
// https://en.wikipedia.org/wiki/WebVTT
//
// For better parsers, look at:
// https://github.com/annevk/webvtt
// https://github.com/mozilla/vtt.js
function quick_and_dirty_vtt_or_srt_parser(vtt) {
  var lines = vtt.trim().replace('\r\n', '\n').split(/[\r\n]/).map(function(line) {
    return line.trim();
  });
  var cues = [];
  var start = null;
  var end = null;
  var payload = null;
  for (var i = 0; i < lines.length; i++) {
    if (lines[i].indexOf('-->') >= 0) {
      var splitted = lines[i].split(/[ \t]+-->[ \t]+/);
      if (splitted.length != 2) {
        throw 'Error when splitting "-->": ' + lines[i];
      }

      // Already ignoring anything past the "end" timestamp (i.e. cue settings).
      start = parse_timestamp(splitted[0]);
      end = parse_timestamp(splitted[1]);
    } else if (lines[i] == '') {
      if (start && end) {
        var cue = new VTTCue(start, end, payload);
        cues.push(cue);
        start = null;
        end = null;
        payload = null;
      }
    } else if(start && end) {
      if (payload == null) {
        payload = lines[i];
      } else {
        payload += '\n' + lines[i];
      }
    }
  }
  if (start && end) {
    var cue = new VTTCue(start, end, payload);
    cues.push(cue);
  }

  return cues;
}

function init() {
  // http://www.html5rocks.com/en/tutorials/track/basics/
  // https://www.iandevlin.com/blog/2015/02/javascript/dynamically-adding-text-tracks-to-html5-video
  var video = document.querySelector('video');
  var subtitle = document.getElementById('subtitle');
  var track = video.addTextTrack('subtitles', subtitle.dataset.label, subtitle.dataset.lang);
  track.mode = "showing";
  quick_and_dirty_vtt_or_srt_parser(subtitle.innerHTML).map(function(cue) {
    track.addCue(cue);
  });
}
init();
</script>
<!-- <script src="assets/js/main.js"></script> -->
<script src="assets/js/main_slider_video.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.11/addons/p5.sound.min.js"></script>

</body>
</html>

